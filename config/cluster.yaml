# =============================================================================
# CLUSTER CONFIGURATION - JUPITER
# =============================================================================
#
# This file defines your device cluster for distributed training.
#
# EXAMPLE CONFIGURATION:
# - 1 MacBook 24GB as data generator
# - 4 Mac Mini M4 16GB as trainers
# - 1 PC with RTX 4090 as additional trainer (optional)
#
# =============================================================================

# Communication backend
# Options: "mpi", "ring", "jaccl" (Thunderbolt 5 only)
backend: "mpi"

# Use Thunderbolt bridge for direct communication
use_thunderbolt_bridge: true

# Sync gradients every N steps (1 = every step)
sync_every_n_steps: 1

# Compress gradients to reduce network traffic
gradient_compression: false

# Fault tolerance
checkpoint_on_failure: true
auto_restart_failed_nodes: true

# =============================================================================
# CLUSTER NODES
# =============================================================================

nodes:
  # ---------------------------------------------------------------------------
  # Main generator node (MacBook)
  # ---------------------------------------------------------------------------
  - host: "macbook.local"        # Hostname or IP
    name: "Main MacBook"          # Friendly name (optional)
    device_type: "mac"            # "mac", "nvidia", "cpu"
    memory_gb: 24                 # Available RAM
    chip: "M4"                    # Specific chip
    role: "generator"             # "generator", "trainer", "hybrid", "evaluator"
    connection_type: "thunderbolt"  # "thunderbolt", "ethernet", "wifi"
    ssh_user: null                # SSH user (null = current user)
    ssh_port: 22
    can_generate: true
    can_train: false              # Generator doesn't train (dedicated)

  # ---------------------------------------------------------------------------
  # Training nodes (Mac Minis)
  # ---------------------------------------------------------------------------
  - host: "mac-mini-1.local"
    name: "Mac Mini 1"
    device_type: "mac"
    memory_gb: 16
    chip: "M4"
    role: "trainer"
    connection_type: "thunderbolt"
    can_generate: false
    can_train: true

  - host: "mac-mini-2.local"
    name: "Mac Mini 2"
    device_type: "mac"
    memory_gb: 16
    chip: "M4"
    role: "trainer"
    connection_type: "thunderbolt"
    can_generate: false
    can_train: true

  - host: "mac-mini-3.local"
    name: "Mac Mini 3"
    device_type: "mac"
    memory_gb: 16
    chip: "M4"
    role: "trainer"
    connection_type: "thunderbolt"
    can_generate: false
    can_train: true

  - host: "mac-mini-4.local"
    name: "Mac Mini 4"
    device_type: "mac"
    memory_gb: 16
    chip: "M4"
    role: "trainer"
    connection_type: "thunderbolt"
    can_generate: false
    can_train: true

  # ---------------------------------------------------------------------------
  # Optional NVIDIA node
  # ---------------------------------------------------------------------------
  # Uncomment to add an NVIDIA GPU to the cluster
  #
  # - host: "192.168.1.100"
  #   name: "RTX 4090 Workstation"
  #   device_type: "nvidia"
  #   memory_gb: 24               # VRAM
  #   chip: "RTX 4090"
  #   role: "trainer"
  #   connection_type: "ethernet"
  #   ssh_user: "user"
  #   can_generate: false
  #   can_train: true
